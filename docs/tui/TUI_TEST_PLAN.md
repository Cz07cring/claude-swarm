# TUI Monitor 综合测试计划

## 测试日期
2026-01-31

## 测试目标
对新实现的 TUI Monitor 进行全面功能测试，验证其功能完整性、性能表现和用户体验。

---

## 一、当前实现功能分析

### 1.1 已实现功能 ✅

#### 基础布局
- ✅ 三窗格布局（任务列表 | Agent 网格 | 日志查看器）
- ✅ 响应式窗口大小调整
- ✅ 自适应内容高度和宽度

#### 导航和交互
- ✅ Tab: 前向切换面板
- ✅ Shift+Tab: 反向切换面板
- ✅ ↑/k: 向上导航
- ✅ ↓/j: 向下导航
- ✅ ←/h: 在 Agent 网格中向左移动
- ✅ →/l: 在 Agent 网格中向右移动
- ✅ q / Ctrl+C: 退出程序

#### 数据显示
- ✅ 任务列表显示（状态、描述、分配者、时间）
- ✅ 任务状态可视化（○ 待处理、● 进行中、✓ 完成、✗ 失败）
- ✅ Agent 网格显示（3x3 网格布局）
- ✅ Agent 状态可视化（○ 空闲、● 工作中、? 等待确认、✗ 错误、⏸ 卡住）
- ✅ 日志查看器（显示选中 Agent 或任务相关 Agent 的输出）
- ✅ 相对时间显示（Xs, Xm, Xh, Xd）

#### 数据刷新
- ✅ 自动刷新（每 2 秒）
- ✅ 任务队列实时更新
- ✅ Agent 状态实时更新
- ✅ 日志内容实时更新

#### 视觉效果
- ✅ 颜色编码状态指示
- ✅ 选中项高亮显示
- ✅ 活动面板边框高亮
- ✅ 智能滚动（保持选中项可见）

### 1.2 未实现功能 ❌

根据用户测试目标，以下功能尚未实现：

- ❌ **任务过滤功能**（按键 1-4）
  - 按状态过滤任务
  - 快速筛选待处理/进行中/已完成/失败的任务

- ❌ **Agent 性能统计**
  - 完成任务数统计
  - 平均任务耗时
  - 成功率统计
  - CPU/内存使用情况

- ❌ **帮助面板**（按键 ?）
  - 快捷键列表
  - 功能说明
  - 可切换显示/隐藏

- ❌ **主题切换**（按键 t）
  - 亮色主题
  - 暗色主题
  - 主题持久化配置

---

## 二、测试计划

### 2.1 基础功能测试

#### 测试 1: 启动和初始化
**步骤：**
1. 运行 `./test-tui.sh` 准备测试数据
2. 启动 TUI Monitor
3. 验证初始显示

**预期结果：**
- 程序正常启动
- 三个面板正确显示
- 测试数据正确加载（5 个任务，5 个 Agent）
- 默认选中任务列表面板

#### 测试 2: 面板切换
**步骤：**
1. 按 Tab 键切换到 Agent 网格
2. 再按 Tab 切换到日志查看器
3. 再按 Tab 返回任务列表
4. 按 Shift+Tab 反向切换

**预期结果：**
- 面板切换流畅
- 活动面板边框高亮正确更新
- 面板标题显示 ◄ 指示符

#### 测试 3: 任务列表导航
**步骤：**
1. 在任务列表面板，使用 j/k 或 ↑/↓ 导航
2. 观察选中项高亮
3. 观察日志查看器内容变化

**预期结果：**
- 导航流畅无卡顿
- 选中项正确高亮
- 日志查看器显示相关 Agent 输出

#### 测试 4: Agent 网格导航
**步骤：**
1. 切换到 Agent 网格面板
2. 使用 hjkl 或箭头键在网格中移动
3. 观察选中 Agent 的边框高亮
4. 观察日志查看器内容变化

**预期结果：**
- 2D 网格导航正确工作
- 边界处理正确（不越界）
- 选中 Agent 边框加粗高亮
- 日志查看器实时更新

#### 测试 5: 状态可视化
**步骤：**
1. 观察不同状态的任务显示
2. 观察不同状态的 Agent 显示
3. 验证颜色和图标的正确性

**预期结果：**
- 任务状态：○ 待处理（灰色）、● 进行中（蓝色）、✓ 完成（绿色）、✗ 失败（红色）
- Agent 状态：○ 空闲（灰色）、● 工作中（蓝色）、? 等待（黄色）、✗ 错误（红色）

### 2.2 数据刷新测试

#### 测试 6: 自动刷新
**步骤：**
1. 启动 TUI Monitor
2. 在另一个终端修改 `~/.claude-swarm/tasks.json`
3. 观察 TUI 是否自动更新（最多 2 秒延迟）

**预期结果：**
- 数据在 2 秒内自动刷新
- 界面平滑更新无闪烁

#### 测试 7: 空数据处理
**步骤：**
1. 清空任务列表
2. 清空 Agent 列表
3. 观察显示效果

**预期结果：**
- 任务面板显示 "No tasks"
- Agent 面板显示 "No agents"
- 程序不崩溃

### 2.3 压力测试

#### 测试 8: 大量任务
**步骤：**
1. 创建 100+ 任务的测试数据
2. 启动 TUI Monitor
3. 快速滚动任务列表
4. 观察性能和响应速度

**预期结果：**
- 导航流畅无明显延迟
- 内存使用稳定
- 智能滚动保持选中项可见

#### 测试 9: 大量 Agent
**步骤：**
1. 创建 20+ Agent 的测试数据
2. 观察网格布局
3. 测试导航

**预期结果：**
- 网格正确显示所有 Agent
- 多行网格导航正确
- 渲染性能良好

#### 测试 10: 长日志输出
**步骤：**
1. 创建包含大量日志的 Agent
2. 观察日志查看器显示
3. 测试滚动和截断

**预期结果：**
- 长日志正确截断或滚动
- 不影响整体性能
- 显示最相关的日志内容

### 2.4 边界条件测试

#### 测试 11: 窗口大小调整
**步骤：**
1. 启动 TUI Monitor
2. 调整终端窗口大小
3. 测试极小窗口和极大窗口

**预期结果：**
- 布局自适应调整
- 小窗口下内容适当截断
- 大窗口下内容合理分布

#### 测试 12: 特殊字符处理
**步骤：**
1. 在任务描述中使用特殊字符、emoji、中文
2. 观察显示效果

**预期结果：**
- 正确显示各种字符
- 布局不错位
- 长文本正确截断

### 2.5 退出测试

#### 测试 13: 正常退出
**步骤：**
1. 按 'q' 退出
2. 验证程序清理

**预期结果：**
- 显示 "Goodbye!" 消息
- 程序正常退出
- 终端恢复正常状态

#### 测试 14: 强制退出
**步骤：**
1. 按 Ctrl+C 退出

**预期结果：**
- 程序立即退出
- 终端恢复正常状态

---

## 三、功能增强建议

基于用户测试目标，建议实现以下功能：

### 优先级 1 (高) - 帮助面板
**功能：** 按 '?' 显示/隐藏帮助面板
**理由：** 提高用户体验，帮助用户快速了解所有快捷键

**实现要点：**
- 在 Dashboard 中添加 `showHelp bool` 字段
- 处理 '?' 按键切换帮助显示
- 帮助面板覆盖在主界面上方或作为第四个面板
- 列出所有快捷键和功能说明

### 优先级 2 (高) - 任务过滤
**功能：** 按 1-4 键过滤任务状态
**理由：** 在大量任务时快速定位特定状态的任务

**实现要点：**
- 在 TaskListView 中添加 `filter TaskStatus` 字段
- 1: 显示所有任务
- 2: 仅显示待处理任务
- 3: 仅显示进行中任务
- 4: 仅显示已完成/失败任务
- 在任务面板标题显示当前过滤器

### 优先级 3 (中) - Agent 性能统计
**功能：** 显示每个 Agent 的性能指标
**理由：** 帮助监控和优化 Agent 性能

**实现要点：**
- 扩展 AgentStatus 模型添加统计字段
- 在 Agent cell 中显示关键指标
- 可能需要新的统计面板

### 优先级 4 (低) - 主题切换
**功能：** 按 't' 切换亮/暗主题
**理由：** 适应不同用户偏好和环境

**实现要点：**
- 定义两套颜色方案
- 在 Dashboard 中添加 `theme string` 字段
- 处理 't' 按键切换主题
- 可选：持久化主题配置到文件

---

## 四、测试检查清单

### 基础功能
- [ ] 程序正常启动
- [ ] 三窗格布局正确显示
- [ ] Tab 切换面板工作正常
- [ ] ↑↓jk 导航工作正常
- [ ] ←→hl 在 Agent 网格中工作正常
- [ ] 任务状态正确显示
- [ ] Agent 状态正确显示
- [ ] 日志查看器正确更新
- [ ] q 退出工作正常
- [ ] Ctrl+C 退出工作正常

### 数据显示
- [ ] 任务列表显示完整信息
- [ ] Agent 网格显示正确
- [ ] 时间显示格式正确
- [ ] 选中项高亮正确
- [ ] 活动面板边框高亮
- [ ] 空数据正确处理

### 性能和稳定性
- [ ] 自动刷新工作正常（2秒间隔）
- [ ] 大量任务下性能良好
- [ ] 大量 Agent 下性能良好
- [ ] 长日志正确处理
- [ ] 窗口调整响应正确
- [ ] 无内存泄漏
- [ ] 无崩溃或错误

### 用户体验
- [ ] 导航流畅直观
- [ ] 颜色编码清晰易懂
- [ ] 信息显示简洁明了
- [ ] 特殊字符正确显示
- [ ] 终端恢复正常

---

## 五、测试环境

- **操作系统：** macOS (Darwin 24.6.0)
- **Go 版本：** (执行 `go version` 获取)
- **终端：** (记录终端类型和尺寸)
- **测试数据：** test-tui.sh 生成的标准测试数据

---

## 六、问题记录模板

### 问题 #X
**类型：** Bug / 功能缺失 / 性能问题 / 用户体验
**严重程度：** 低 / 中 / 高 / 致命
**描述：** [详细描述问题]
**复现步骤：**
1. 步骤 1
2. 步骤 2
3. ...

**预期行为：** [应该如何工作]
**实际行为：** [实际发生了什么]
**影响：** [问题的影响范围]
**建议修复：** [可选的修复建议]

---

## 七、测试结果总结模板

### 测试执行摘要
- **测试日期：** YYYY-MM-DD
- **测试人员：** [姓名]
- **测试时长：** [小时]
- **执行的测试数量：** X/Y

### 结果统计
- **通过：** X 项
- **失败：** Y 项
- **阻塞：** Z 项
- **跳过：** W 项

### 发现的问题
- **致命问题：** X 个
- **高优先级：** Y 个
- **中优先级：** Z 个
- **低优先级：** W 个

### 总体评价
[对 TUI Monitor 的总体评价和建议]

### 下一步行动
1. [行动项 1]
2. [行动项 2]
3. ...
