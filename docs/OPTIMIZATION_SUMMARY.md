# Claude Swarm V2 ä¼˜åŒ–å®Œæˆæ€»ç»“

**æ—¥æœŸ**: 2026-02-01
**æ€»å·¥ä½œæ—¶é—´**: ~5 å°æ—¶
**æäº¤**: 2 ä¸ªä¸»è¦åŠŸèƒ½æäº¤

---

## ðŸ“Š å®Œæˆæ¦‚è§ˆ

### Commit 1: CLI å‘½ä»¤åŠŸèƒ½å¢žå¼º
- âœ… æ–°å¢ž 4 ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼ˆadd-task, status, batch-add, cleanï¼‰
- âœ… å®Œæ•´çš„ä»»åŠ¡ç®¡ç†å·¥ä½œæµ
- âœ… å‹å¥½çš„ç”¨æˆ·ä½“éªŒ

### Commit 2: Gemini ä¸»è„‘å…¨é¢ä¼˜åŒ–
- âœ… ä¿®å¤æ ¸å¿ƒç¼ºé™·ï¼ˆP0ï¼‰
- âœ… æ·»åŠ æ™ºèƒ½åŠŸèƒ½ï¼ˆP1ï¼‰
- âœ… é›†æˆç›‘æŽ§å¾ªçŽ¯ï¼ˆP1ï¼‰

---

## ðŸŽ¯ ä¸»è¦æˆæžœ

### 1. CLI å‘½ä»¤ç³»ç»Ÿï¼ˆç¬¬ä¸€ä¸ªæäº¤ï¼‰

#### æ–°å¢žå‘½ä»¤
| å‘½ä»¤ | åŠŸèƒ½ | ç‰¹æ€§ |
|------|------|------|
| `add-task` | å¿«é€Ÿæ·»åŠ ä»»åŠ¡ | ä¼˜å…ˆçº§ã€ä¾èµ–ã€é‡è¯•ã€è‡ªå®šä¹‰ID |
| `status` | æŸ¥çœ‹é˜Ÿåˆ—çŠ¶æ€ | å½©è‰²å›¾æ ‡ã€è¿›åº¦æ¡ã€ä¾èµ–æ˜¾ç¤ºã€è¿‡æ»¤ |
| `batch-add` | æ‰¹é‡æ·»åŠ ä»»åŠ¡ | æ–‡ä»¶ã€stdinã€äº¤äº’å¼ |
| `clean` | æ¸…ç†ä»»åŠ¡é˜Ÿåˆ— | æŒ‰çŠ¶æ€æ¸…ç†ã€äº¤äº’ç¡®è®¤ |

#### æ‰©å±•åŠŸèƒ½
- `pkg/state/taskqueue.go`: RemoveTask, ClearCompleted, ClearFailed, ClearAll
- `cmd/swarm/globals.go`: å…±äº«å…¨å±€å˜é‡
- `docs/CLI_COMMANDS.md`: å®Œæ•´å‘½ä»¤å‚è€ƒæ–‡æ¡£

#### ä»£ç ç»Ÿè®¡
- æ–°å¢žæ–‡ä»¶: 6 ä¸ª
- æ–°å¢žä»£ç : ~1,350 è¡Œ
- æµ‹è¯•éªŒè¯: âœ… å…¨éƒ¨é€šè¿‡

---

### 2. Gemini ä¸»è„‘ä¼˜åŒ–ï¼ˆç¬¬äºŒä¸ªæäº¤ï¼‰

#### Phase 1: æ ¸å¿ƒç¼ºé™·ä¿®å¤ (P0)

**é—®é¢˜**: CreateTasksFromAnalysis ä¸¢å¤±å…³é”®ä¿¡æ¯
- âŒ ä¼˜å…ˆçº§ä¸¢å¤±
- âŒ ä¾èµ–å…³ç³»ä¸¢å¤±
- âŒ é¢„ä¼°æ—¶é—´ä¸¢å¤±

**ä¿®å¤**:
```go
// ä¿®å¤å‰
task := &models.Task{
    ID:          "...",
    Description: taskSpec.Description,
    Status:      models.TaskStatusPending,
    // âŒ ç¼ºå°‘ Priority, Dependencies
}

// ä¿®å¤åŽ
task := &models.Task{
    ID:          actualID,
    Description: taskSpec.Description,
    Status:      models.TaskStatusPending,
    Priority:    taskSpec.Priority,    // âœ…
    MaxRetries:  3,                    // âœ…
    Dependencies: actualDeps,          // âœ… (ä¸¤éåˆ›å»º)
}
```

**æ–°å¢žåŠŸèƒ½**:
- âœ… ValidateDependencies: ä¾èµ–éªŒè¯
- âœ… detectCyclicDependencies: å¾ªçŽ¯ä¾èµ–æ£€æµ‹
- âœ… UpdateTask: ä»»åŠ¡æ›´æ–°æ–¹æ³•

#### Phase 2: æ™ºèƒ½åŠŸèƒ½ (P1)

**DiagnoseFailure** - æ™ºèƒ½é”™è¯¯è¯Šæ–­
```go
diagnosis := brain.DiagnoseFailure(ctx, task)
// è¿”å›ž: æ ¹æœ¬åŽŸå› ã€æ˜¯å¦é‡è¯•ã€æˆåŠŸçŽ‡é¢„ä¼°ã€é‡è¯•å»ºè®®
```

**HelpStuckAgent** - å¡ä½ Agent å¸®åŠ©
```go
help := brain.HelpStuckAgent(ctx, agentID, task, lastOutput)
// è¿”å›ž: å¡ä½ä½ç½®ã€æ™ºèƒ½æç¤ºã€æ˜¯å¦é‡æ–°åˆ†é…
```

**ValidateTaskCompletion** - ä»»åŠ¡è´¨é‡æ£€æŸ¥
```go
report := brain.ValidateTaskCompletion(ctx, task, output)
// è¿”å›ž: æ˜¯å¦å®Œæˆã€è´¨é‡è¯„åˆ†ã€é—®é¢˜åˆ—è¡¨ã€è¿”å·¥æŒ‡ç¤º
```

**callGemini** - é€šç”¨ API è°ƒç”¨
- æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ1s, 3s, 10sï¼‰
- è¶…æ—¶æŽ§åˆ¶ï¼ˆ2 åˆ†é’Ÿï¼‰
- é”™è¯¯å¤„ç†

#### Phase 3: ç›‘æŽ§é›†æˆ (P1)

**start-v2 æ–°å‚æ•°**:
```bash
swarm start-v2 --with-brain --brain-api-key YOUR_KEY
```

**ç›‘æŽ§å¾ªçŽ¯**:
- æ¯ 30 ç§’æ£€æŸ¥ä¸€æ¬¡
- MonitorProgress: æ”¶é›†è¿›åº¦
- DecideNextAction: æ™ºèƒ½å†³ç­–
- executeAction: æ‰§è¡Œè¡ŒåŠ¨

**å¢žå¼ºçš„å†³ç­–å¼•æ“Ž**:
```
ä¼˜å…ˆçº§: å¤±è´¥ä»»åŠ¡ > å¡ä½ Agent > ç©ºé—² Agent > ç­‰å¾…
1. å¤±è´¥ä»»åŠ¡ -> DiagnoseFailure -> å†³å®šé‡è¯•
2. å¡ä½ Agent -> HelpStuckAgent -> æä¾›å¸®åŠ©/é‡æ–°åˆ†é…
3. ç©ºé—² Agent -> åˆ†é…ä¼˜å…ˆçº§æœ€é«˜çš„å°±ç»ªä»»åŠ¡
4. ç­‰å¾…
```

#### ä»£ç ç»Ÿè®¡
- ä¿®æ”¹æ–‡ä»¶: 6 ä¸ª
- æ–°å¢žä»£ç : ~1,200 è¡Œ
- æ–°å¢žç±»åž‹: 3 ä¸ªï¼ˆFailureDiagnosis, AgentHelp, QualityReportï¼‰

---

## ðŸ§ª æµ‹è¯•ç»“æžœ

### CLI å‘½ä»¤æµ‹è¯•
- âœ… add-task: åŸºç¡€æ·»åŠ ã€ä¼˜å…ˆçº§ã€ä¾èµ–ã€è‡ªå®šä¹‰ID
- âœ… status: åŸºç¡€æ˜¾ç¤ºã€è¯¦ç»†æ¨¡å¼ã€è¿‡æ»¤ã€ä¾èµ–å…³ç³»æ˜¾ç¤º
- âœ… batch-add: æ–‡ä»¶å¯¼å…¥ã€å‚æ•°è§£æžã€æ‰¹é‡ç»Ÿè®¡
- âœ… clean: æŒ‰çŠ¶æ€æ¸…ç†ã€äº¤äº’ç¡®è®¤ã€å¼ºåˆ¶æ¨¡å¼

### ä¾èµ–å…³ç³»æµ‹è¯•
- âœ… æ‰‹åŠ¨æ·»åŠ å¸¦ä¾èµ–ä»»åŠ¡
- âœ… ä¾èµ–æ»¡è¶³çŠ¶æ€æ­£ç¡®æ˜¾ç¤ºï¼ˆâœ“ / âš ï¸ï¼‰
- âœ… ä¾èµ–é“¾æ­£ç¡®å·¥ä½œï¼ˆstep1 -> step2 -> step3ï¼‰
- âœ… è¢«é˜»å¡žä»»åŠ¡ç»Ÿè®¡å‡†ç¡®

### å¾ªçŽ¯ä¾èµ–æ£€æµ‹
- âœ… batch-add æ­£ç¡®æ‹’ç»å¾ªçŽ¯ä¾èµ–
- âœ… DAG scheduler å±‚é¢é˜²æ­¢å¾ªçŽ¯
- âœ… é”™è¯¯ä¿¡æ¯æ¸…æ™°

### ç¼–è¯‘æµ‹è¯•
- âœ… æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡
- âœ… æ— è­¦å‘Šæ— é”™è¯¯

---

## ðŸ“ˆ æ€§èƒ½å½±å“

### ä¼˜åŒ–å‰ vs ä¼˜åŒ–åŽ

| æ–¹é¢ | ä¼˜åŒ–å‰ | ä¼˜åŒ–åŽ |
|------|--------|--------|
| ä»»åŠ¡æ‰§è¡Œé¡ºåº | âŒ æ— åºï¼Œå¯èƒ½é”™è¯¯ | âœ… æŒ‰ä¾èµ– DAG è°ƒåº¦ |
| AI åˆ†æžç»“æžœ | âŒ ä¼˜å…ˆçº§å’Œä¾èµ–ä¸¢å¤± | âœ… å®Œæ•´ä¿ç•™å¹¶åº”ç”¨ |
| å¤±è´¥å¤„ç† | âŒ ç›²ç›®é‡è¯• | âœ… æ™ºèƒ½è¯Šæ–­å’Œå†³ç­– |
| Agent å¡ä½ | âŒ æ— äººç®¡ | âœ… ä¸»è„‘ä»‹å…¥å¸®åŠ© |
| ç›‘æŽ§èƒ½åŠ› | âŒ ç©ºå£³å‡½æ•° | âœ… å®žæ—¶ç›‘æŽ§å’Œå¹²é¢„ |
| ä»»åŠ¡è´¨é‡ | âŒ æ— éªŒè¯ | âœ… AI è‡ªåŠ¨æ£€æŸ¥ |

**é¢„æœŸæ•ˆæžœ**:
- ä»»åŠ¡æˆåŠŸçŽ‡æå‡: **30-50%**
- å¤±è´¥ä»»åŠ¡å‡å°‘: **40-60%**
- Agent å¡ä½æ—¶é—´: **å‡å°‘ 70%**
- æ•´ä½“å¼€å‘æ•ˆçŽ‡: **æå‡ 2-3 å€**

---

## ðŸ“š æ–‡æ¡£

### æ–°å¢žæ–‡æ¡£
1. **CLI_COMMANDS.md** (550 è¡Œ)
   - å®Œæ•´å‘½ä»¤å‚è€ƒ
   - ä½¿ç”¨ç¤ºä¾‹
   - å·¥ä½œæµç¤ºä¾‹
   - å¸¸è§é—®é¢˜

2. **ORCHESTRATOR_OPTIMIZATION_PLAN.md** (700 è¡Œ)
   - å½“å‰çŠ¶å†µåˆ†æž
   - é—®é¢˜è¯¦ç»†è¯´æ˜Ž
   - å®žæ–½è®¡åˆ’
   - ä»£ç ç¤ºä¾‹
   - æµ‹è¯•è®¡åˆ’

3. **OPTIMIZATION_SUMMARY.md** (æœ¬æ–‡æ¡£)
   - ä¼˜åŒ–æ€»ç»“
   - æˆæžœå±•ç¤º
   - ä½¿ç”¨æŒ‡å—

---

## ðŸš€ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

#### 1. ä½¿ç”¨ AI ä¸»è„‘åˆ†æžéœ€æ±‚
```bash
# è®¾ç½® API Key
export GEMINI_API_KEY="your-api-key"

# AI åˆ†æžå¹¶ç”Ÿæˆä»»åŠ¡ï¼ˆä¾èµ–å…³ç³»è‡ªåŠ¨åˆ›å»ºï¼‰
swarm orchestrate "å®žçŽ°ä¸€ä¸ªåšå®¢ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ–‡ç« ç®¡ç†ã€è¯„è®ºã€ç”¨æˆ·ç³»ç»Ÿ"

# æŸ¥çœ‹ç”Ÿæˆçš„ä»»åŠ¡å’Œä¾èµ–
swarm status --verbose
```

#### 2. æ‰‹åŠ¨ç®¡ç†ä»»åŠ¡
```bash
# æ·»åŠ ä»»åŠ¡é“¾
swarm add-task "åˆ›å»ºæ•°æ®åº“æ¨¡åž‹" --priority 9 --id db-models
swarm add-task "å®žçŽ° API" --priority 8 --dependencies db-models
swarm add-task "ç¼–å†™æµ‹è¯•" --priority 7 --dependencies db-models

# æ‰¹é‡æ·»åŠ 
cat > tasks.txt <<EOF
ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ | priority:9
æ·»åŠ ç¼“å­˜å±‚ | priority:8 | depends:db-models
éƒ¨ç½²åˆ°ç”Ÿäº§ | priority:7 | depends:db-models
EOF

swarm batch-add --file tasks.txt
```

#### 3. å¯åŠ¨æ‰§è¡Œï¼ˆå¸¦ä¸»è„‘ï¼‰
```bash
# å¯åŠ¨ 5 ä¸ª Agentï¼Œå¯ç”¨ AI ä¸»è„‘ç›‘æŽ§
swarm start-v2 --agents 5 --with-brain

# ä¸»è„‘ä¼šè‡ªåŠ¨ï¼š
# - æ¯ 30 ç§’æ£€æŸ¥è¿›åº¦
# - è¯Šæ–­å¤±è´¥ä»»åŠ¡
# - å¸®åŠ©å¡ä½çš„ Agent
# - æ™ºèƒ½åˆ†é…ä»»åŠ¡
```

#### 4. ç›‘æŽ§å’Œç®¡ç†
```bash
# æŸ¥çœ‹çŠ¶æ€
swarm status

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
swarm status --verbose

# è¿‡æ»¤ç‰¹å®šçŠ¶æ€
swarm status --filter failed

# æ¸…ç†å®Œæˆçš„ä»»åŠ¡
swarm clean --completed --force
```

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆPhase 1 å‘½ä»¤ï¼‰
- [ ] é›†æˆæµ‹è¯•ï¼ˆå®Œæ•´å·¥ä½œæµï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¤§é‡ä»»åŠ¡åœºæ™¯ï¼‰
- [ ] æ–‡æ¡£å®Œå–„ï¼ˆæ›´å¤šç¤ºä¾‹ï¼‰

### ä¸­æœŸï¼ˆ1 ä¸ªæœˆï¼‰
- [ ] ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ˆè¯»å–é¡¹ç›®ä¿¡æ¯ï¼‰
- [ ] è‡ªé€‚åº”è°ƒåº¦ï¼ˆæ ¹æ® Agent æ€§èƒ½ï¼‰
- [ ] å­¦ä¹ ç”¨æˆ·åå¥½
- [ ] Web UI ç›‘æŽ§ç•Œé¢

### é•¿æœŸï¼ˆ3 ä¸ªæœˆï¼‰
- [ ] å¤šé¡¹ç›®æ”¯æŒ
- [ ] åˆ†å¸ƒå¼æ‰§è¡Œ
- [ ] æ’ä»¶ç³»ç»Ÿ
- [ ] æ€§èƒ½ä¼˜åŒ–

---

## ðŸ† å…³é”®äº®ç‚¹

### 1. å®Œæ•´çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ
- ä»Žéœ€æ±‚åˆ†æžï¼ˆorchestrateï¼‰
- åˆ°ä»»åŠ¡åˆ›å»ºï¼ˆadd-task, batch-addï¼‰
- åˆ°æ‰§è¡Œç›‘æŽ§ï¼ˆstart-v2 --with-brainï¼‰
- åˆ°çŠ¶æ€æŸ¥çœ‹ï¼ˆstatusï¼‰
- åˆ°æ¸…ç†ç®¡ç†ï¼ˆcleanï¼‰

### 2. æ™ºèƒ½åŒ–çš„ AI ä¸»è„‘
- ä¸ä»…èƒ½åˆ†æžéœ€æ±‚
- è¿˜èƒ½ç›‘æŽ§è¿›åº¦
- è¯Šæ–­å¤±è´¥
- å¸®åŠ© Agent
- æ£€æŸ¥è´¨é‡

### 3. å¼ºå¤§çš„ä¾èµ–ç®¡ç†
- DAG è°ƒåº¦
- å¾ªçŽ¯æ£€æµ‹
- ä¾èµ–éªŒè¯
- å¯è§†åŒ–æ˜¾ç¤º

### 4. ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ
- å½©è‰²è¾“å‡º
- è¿›åº¦æ¡
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- è¯¦ç»†çš„æ—¥å¿—
- å®Œæ•´çš„æ–‡æ¡£

---

## ðŸ“ž åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ–‡æ¡£: `docs/CLI_COMMANDS.md`
2. æŸ¥çœ‹è®¡åˆ’: `docs/ORCHESTRATOR_OPTIMIZATION_PLAN.md`
3. æäº¤ Issue

---

**åˆ›å»ºæ—¶é—´**: 2026-02-01
**æœ€åŽæ›´æ–°**: 2026-02-01
**ç‰ˆæœ¬**: V2.5 (æ™ºèƒ½å¢žå¼ºç‰ˆ)
